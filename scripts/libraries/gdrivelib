#!/bin/bash
# shellcheck shell=bash disable=1091

# Copyright The Red Cyclops Â© 2023
# This program is free software: you can redistribute it and/or modify it under the terms of
# the GNU General Public License as published by the Free Software Foundation,
# either version 3 of the License, or (at your option) any later version.
# This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
# without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
# See the GNU General Public License for more details.
# You should have received a copy of the GNU General Public License along with this program.
# If not, see <https://www.gnu.org/licenses/>.

#Import libraries
source formatlib

# Add the functions
# Gets the File ID from google drive of a file specified with a regex
gdriveinit() {
    gdrive account switch "$EMAIL"
}
getfileid(){
    # Allow for searching inside folders
    if [ "$1" = "--parent" ]; then
        gdrive files list --parent "$2" | grep -i -E "$3" | sed -E 's/[ ].*//g'
    fi
    gdrive files list | grep -i -E "$1" | sed -E 's/[ ].*//g'
}
# Download a file or folder from google drive given a file id to a given path
downloadfile(){
    if [ -z "$2" ]; then
    error "Output file wasn't especifed"
    fi
    tmpdir=$(mktemp -d)
    gdrive files download "$1" --destination "$2" 2> "$tmpdir/gdrive-error"
    if grep -q 'fileNotDownloadable' "$tmpdir/gdrive-error"; then
        gdrive files export "$1" "$2.txt"
        mv "$2.txt" "$2"
    fi
    if grep -q 'is a directory' "$tmpdir/gdrive-error"; then
        gdrive files download --recursive "$1" --destination "$2"
    fi
    rm "$tmpdir/gdrive-error"
}